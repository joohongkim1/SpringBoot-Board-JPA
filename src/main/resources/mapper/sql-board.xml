<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- mapper 의 네임 스페이스 지정 -->
<mapper namespace="board.mapper.BoardMapper">
	<select id="selectBoardList" resultType="board.dto.BoardDto">
			SELECT
				id,
				title,
				hit,
				created_at
			FROM
				t_board
			WHERE
				deleted_yn = 'N'
			ORDER BY id DESC
	</select>
	<insert id="insertBoard" parameterType="board.dto.BoardDto" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO t_board
		(
			title, contents, creator_id
		)
		VALUES
		(
			#{title}, #{contents}, "admin"
		)
	</insert>
	<update id="updateHit" parameterType="int">
		UPDATE t_board
		SET hit = hit + 1
		WHERE id = #{id}
	</update>
	<select id="selectBoardDetail" parameterType="int" resultType="board.dto.BoardDto">
		SELECT 
			id, title, contents, hit, created_at, creator_id
		FROM
			t_board
		WHERE
			id = #{id} and deleted_yn = 'N'
	</select>
	<update id="updateBoard" parameterType="board.dto.BoardDto">
		UPDATE t_board
		SET 
			title = #{title},
			contents = #{contents},
			updated_at = NOW(),
			updator_id = "admin"
		WHERE id = #{id}
	</update>
	<update id="deleteBoard" parameterType="int">
		UPDATE t_board
		SET
			deleted_yn = 'Y',
			updated_at = NOW(),
			updator_id = "admin"
		WHERE
			id = #{id}
	</update>
	<insert id="insertBoardFileList" parameterType="board.dto.BoardFileDto">
			INSERT INTO t_file
			( 
				board_id, 
				original_file_name, 
				stored_file_path, 
				file_size, 
				creator_id, 
				created_datetime
			)
			VALUES	
		<foreach collection="list" item="item" separator=",">
			(
				#{item.boardId},
				#{item.originalFileName},
				#{item.storedFilePath},
				#{item.fileSize},
				'admin',
				NOW()
			)
		</foreach>
	</insert>
	<select id="selectBoardFileList" parameterType="int" resultType="board.dto.BoardFileDto">
		SELECT id, board_id, original_file_name, FORMAT(ROUND(file_size / 1024), 0) AS file_size
		FROM t_file
		WHERE board_id = #{boardId} AND deleted_yn = 'N'
	</select>
	<select id="selectBoardFileInfo" parameterType="map" resultType="board.dto.BoardFileDto">
		SELECT 
			original_file_name,
			stored_file_path,
			file_size
		FROM
			t_file
		WHERE
			id = #{id}
			AND board_id = #{boardId}
			AND deleted_yn = 'N'
	</select>
	<update id="deleteBoardFile" parameterType="map">
		UPDATE
			t_file
		SET
			deleted_yn = 'Y',
			updated_datetime = NOW(),
			updater_id = 'admin'
		WHERE
			id = #{id} AND board_id=#{boardId}
	</update>
</mapper>
